<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.2"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="[Digging] Data 백만개 어떻게 처리하지..(feat. bulk insert)" /><meta name="author" content="Raccoon" /><meta property="og:locale" content="en_US" /><meta name="description" content="Data 백만개 어떻게 처리하지..(feat. bulk insert)" /><meta property="og:description" content="Data 백만개 어떻게 처리하지..(feat. bulk insert)" /><link rel="canonical" href="https://juddroid.github.io/posts/bulk-insert/" /><meta property="og:url" content="https://juddroid.github.io/posts/bulk-insert/" /><meta property="og:site_name" content="Raccoon" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-02-01T05:06:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="[Digging] Data 백만개 어떻게 처리하지..(feat. bulk insert)" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"Data 백만개 어떻게 처리하지..(feat. bulk insert)","url":"https://juddroid.github.io/posts/bulk-insert/","@type":"BlogPosting","headline":"[Digging] Data 백만개 어떻게 처리하지..(feat. bulk insert)","dateModified":"2021-02-01T05:13:33+09:00","datePublished":"2021-02-01T05:06:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://juddroid.github.io/posts/bulk-insert/"},"author":{"@type":"Person","name":"Raccoon"},"@context":"https://schema.org"}</script><title>[Digging] Data 백만개 어떻게 처리하지..(feat. bulk insert) | Raccoon</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-35DGNMXRP7"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-35DGNMXRP7'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/favicons/ms-icon-310x310.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Raccoon</a></div><div class="site-subtitle font-italic">Digging to the end of the Earth</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/juddroid" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://instagram.com/juddroid_raccoon" aria-label="instagram" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-instagram"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['nobllizdc','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>[Digging] Data 백만개 어떻게 처리하지..(feat. bulk insert)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>[Digging] Data 백만개 어떻게 처리하지..(feat. bulk insert)</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Feb 1, 2021, 5:06 AM +0900" > Feb 1 <i class="unloaded">2021-02-01T05:06:00+09:00</i> </span> by <span class="author"> Raccoon </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, Feb 1, 2021, 5:13 AM +0900" > Feb 1 <i class="unloaded">2021-02-01T05:13:33+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2076 words">11 min</span></div></div><div class="post-content"><h2 id="data-백만개-어떻게-처리하지feat-bulk-insert">Data 백만개 어떻게 처리하지..(feat. bulk insert)</h2><ul><li>며칠전 이런 어줍잖은 <code class="language-plaintext highlighter-rouge">progress bar</code> 를 만들고, 기괴한 코드를 짜놓고, 그래도 백만개의 데이터가 <code class="language-plaintext highlighter-rouge">db</code> 에 들어간다고 좋아했었다.</ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/70361152/106205577-09467080-6202-11eb-81d3-356a784128fe.gif" alt="progressbar" /></p><ul><li>하지만 <code class="language-plaintext highlighter-rouge">db</code> 의 세상에서 <code class="language-plaintext highlighter-rouge">data</code> 백만개는 일도 아니라는데, 저 굼벵이를 10여분간 흐뭇하게 바라보고 있어야 한다는게 영 찝찝하고 웃픈일이 아닐 수가 없었다.<li><p><code class="language-plaintext highlighter-rouge">bulk insert</code> 라는 멋진게 있다고 하는데, 지난 번에 참고한 이 글에 나와 있는 방법으로는 <a href="https://velog.io/@hyeong412/TIL-%EB%8C%80%EC%9A%A9%EB%9F%89-INSERT-%EC%B2%98%EB%A6%AC%ED%95%98%EA%B8%B0">대용량 INSERT 처리하기</a> 만족할만한 결과가 나오지 않았다. 결국 <code class="language-plaintext highlighter-rouge">honux</code> 의 명강의에 힘입어 <code class="language-plaintext highlighter-rouge">LOAD DATA</code> 를 알게 됐고, <code class="language-plaintext highlighter-rouge">csv</code> 를 만들기로 했다.</p><ul><li>csv: comma-separated values</ul></ul><h3 id="1-data-백만개-만들기">1. Data 백만개 만들기</h3><hr /><ul><li>사실 <code class="language-plaintext highlighter-rouge">data</code> 를 생성하는 것도 <code class="language-plaintext highlighter-rouge">sql</code> 문법으로 연습하면 좋았겠지만 앞선 카페 미션에 충격에 빠진 조금이라도 빨리 미션을 해보고 싶어서 <code class="language-plaintext highlighter-rouge">js</code> 로 스크립트를 짜고, <code class="language-plaintext highlighter-rouge">node module</code> 로 푸쉬하는 방법을 선택했다.<li>아직도 방법을 못찾았지만 <code class="language-plaintext highlighter-rouge">node module</code> 로도 <code class="language-plaintext highlighter-rouge">bulk insert</code> 를 하는 방법이 있을거라고 생각했다.<li>그런탓에 <code class="language-plaintext highlighter-rouge">javascript</code> 로 원하는 <code class="language-plaintext highlighter-rouge">data</code> 를 백만개를 생성하는건 아주 오래걸리지는 않았다.</ul><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nx">SetData</span> <span class="p">{</span>
  <span class="nx">nickName</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">randomNumber</span> <span class="o">=</span> <span class="p">(</span><span class="nx">num</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="nx">num</span> <span class="o">-</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">0</span><span class="p">);</span>
    <span class="c1">// 코드가 쓸데없이 너무 길어져서 삭제했다.</span>
    <span class="kd">const</span> <span class="nx">englishName</span> <span class="o">=</span> <span class="p">[];</span> <span class="c1">// 영어단어 100개</span>
    <span class="kd">const</span> <span class="nx">alphabet</span> <span class="o">=</span> <span class="p">[];</span> <span class="c1">// 알파벳 26개</span>

    <span class="kd">const</span> <span class="nx">extractNumber</span> <span class="o">=</span> <span class="p">(</span><span class="nx">num</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">string</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">num</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">string</span> <span class="o">+=</span> <span class="nx">randomNumber</span><span class="p">(</span><span class="mi">9</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">string</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="kd">const</span> <span class="nx">extractString</span> <span class="o">=</span> <span class="p">(</span><span class="nx">num</span><span class="p">,</span> <span class="nx">arr</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">string</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">num</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">string</span> <span class="o">+=</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">randomNumber</span><span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">)];</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">string</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="kd">let</span> <span class="nx">nick</span> <span class="o">=</span> <span class="nx">extractString</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">englishName</span><span class="p">)</span> <span class="o">+</span> <span class="nx">extractString</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nx">alphabet</span><span class="p">)</span> <span class="o">+</span> <span class="nx">extractNumber</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">nick</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">money</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">randomNumber</span> <span class="o">=</span> <span class="p">(</span><span class="nx">num</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="nx">num</span> <span class="o">-</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">return</span> <span class="s2">`</span><span class="p">${</span><span class="nx">randomNumber</span><span class="p">(</span><span class="mi">100000</span><span class="p">)}</span><span class="s2">`</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">randomDate</span><span class="p">(</span><span class="nx">date1</span><span class="p">,</span> <span class="nx">date2</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nx">randomValueBetween</span><span class="p">(</span><span class="nx">min</span><span class="p">,</span> <span class="nx">max</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="nx">max</span> <span class="o">-</span> <span class="nx">min</span><span class="p">)</span> <span class="o">+</span> <span class="nx">min</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">date1</span> <span class="o">=</span> <span class="nx">date1</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">01-01-1970</span><span class="dl">'</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">date2</span> <span class="o">=</span> <span class="nx">date2</span> <span class="o">||</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">toLocaleDateString</span><span class="p">();</span>
    <span class="nx">date1</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">date1</span><span class="p">).</span><span class="nx">getTime</span><span class="p">();</span>
    <span class="nx">date2</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">date2</span><span class="p">).</span><span class="nx">getTime</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">date1</span> <span class="o">&gt;</span> <span class="nx">date2</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">randomValueBetween</span><span class="p">(</span><span class="nx">date2</span><span class="p">,</span> <span class="nx">date1</span><span class="p">)).</span><span class="nx">toISOString</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1">T</span><span class="dl">'</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">randomValueBetween</span><span class="p">(</span><span class="nx">date1</span><span class="p">,</span> <span class="nx">date2</span><span class="p">)).</span><span class="nx">toISOString</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1">T</span><span class="dl">'</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="s1"> </span><span class="dl">'</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">SetData</span> <span class="p">};</span>

</pre></table></code></div></div><ul><li>이렇게 <code class="language-plaintext highlighter-rouge">data</code> 를 세팅해놓고,</ul><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="p">{</span> <span class="nx">SetData</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./setdata.js</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">NICK</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SetData</span><span class="p">().</span><span class="nx">nickName</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">MONEY</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SetData</span><span class="p">().</span><span class="nx">money</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">LAST</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SetData</span><span class="p">().</span><span class="nx">randomDate</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">NUM</span> <span class="o">=</span> <span class="mi">1000000</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">params</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">NUM</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">params</span> <span class="o">=</span> <span class="p">[</span><span class="s2">`</span><span class="p">${</span><span class="nx">NICK</span><span class="p">()}</span><span class="s2">`</span><span class="p">,</span> <span class="s2">`</span><span class="p">${</span><span class="nx">MONEY</span><span class="p">()}</span><span class="s2">`</span><span class="p">,</span> <span class="s2">`</span><span class="p">${</span><span class="nx">LAST</span><span class="p">(</span><span class="dl">'</span><span class="s1">01-29-2021</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">02-28-2021</span><span class="dl">'</span><span class="p">)}</span><span class="s2">`</span><span class="p">];</span>
  <span class="kd">let</span> <span class="nx">join</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="s1">,</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">join</span><span class="p">);</span>
<span class="p">}</span>


</pre></table></code></div></div><ul><li>이렇게 <code class="language-plaintext highlighter-rouge">for</code> 문을 돌리면 백만개 생성은 그렇게 오래 걸리지는 않는다.</ul><h3 id="2-csv-파일을-어떻게-만들지">2. CSV 파일을 어떻게 만들지…</h3><hr /><ul><li><p><code class="language-plaintext highlighter-rouge">node</code> 에 있는 <code class="language-plaintext highlighter-rouge">mysql</code> 모듈에 접속하는 것도 권한문제 때문에 두어시간 거하게 삽질을 했는데, 막상 연결해놓고 나니 개념도 분명치 않아서 어떻게 사용해야할지 더욱 막막했다.</p><li><p>그냥 <code class="language-plaintext highlighter-rouge">for</code> 문을 돌리면서 <code class="language-plaintext highlighter-rouge">connection</code> 열어놓은 상태에서 백만개 <code class="language-plaintext highlighter-rouge">INSERT</code> 하는건 어느정도 이해가 간다.</p><li><p>그런데 이걸 <code class="language-plaintext highlighter-rouge">csv</code> 파일로 만들고 싶은데, 방법이 떠오르지 않는다.</p><h4 id="1-fswritefile-로-도전">1. <a href="https://nodejs.org/api/fs.html#fs_fs_writefile_file_data_options_callback">fs.writeFile</a> 로 도전!</h4><ul><li><p>파일에 관련된거라면 응당 <code class="language-plaintext highlighter-rouge">fs</code> 모듈이 뭔가를 가지고 있을거라는 생각에 <code class="language-plaintext highlighter-rouge">node</code> 문서를 뒤져보니 <code class="language-plaintext highlighter-rouge">readFile</code> 이라는게 있었다.</p><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">message.txt</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">The file has been saved!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</pre></table></code></div></div><li><p>이렇게 하면 <code class="language-plaintext highlighter-rouge">message.txt</code> 파일이 생성되는데, 다음번 반복문을 돌 때, 파일이 이미 있으면 내용을 <code class="language-plaintext highlighter-rouge">overwrite</code> 한다.</p><li><p><code class="language-plaintext highlighter-rouge">data</code> 에 <code class="language-plaintext highlighter-rouge">argument</code> 로 <code class="language-plaintext highlighter-rouge">Buffer</code> 형식(?)로 넣게 되어 있어서 이거 알아본다고 또 한 세월을 보냈는데 아직 이해하지 못했다.</p><li><p><code class="language-plaintext highlighter-rouge">const data = new Uint8Array(Buffer.from(params))</code></p><li><p>이 방법은 실패</p></ul><h4 id="2-fsappendfile-로-다시-도전">2. <a href="https://nodejs.org/api/fs.html#fs_fs_appendfile_path_data_options_callback">fs.appendFile</a> 로 다시 도전!</h4><div class="language-js highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nx">fs</span><span class="p">.</span><span class="nx">appendFile</span><span class="p">(</span><span class="dl">'</span><span class="s1">message.txt</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">data to append</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">The "data to append" was appended to file!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</pre></table></code></div></div><ul><li>비슷하지만 이번엔 파일이 있으면 추가로 덧붙여서 작성해준다.<li>그런데 100개, 1000개씩은 잘 작성이 되는데, 백만개를 돌리는 순간 터미널이 멈춰버렸다.</ul></ul><ol><li><p><a href="https://ko.wikipedia.org/wiki/%EB%A6%AC%EB%8B%A4%EC%9D%B4%EB%A0%89%EC%85%98">Redirection</a></p><ul><li><p>이것까지 실패하고 한참을 헤매고 있을 무렵 <code class="language-plaintext highlighter-rouge">DD</code> 코드를 살펴보고 있는데, 내거랑 뭔가 비슷한데 안비슷했다.</p><li><p>도대체 어떻게 쟤네가 다 저 파일로 갑자기 간건지 너무 궁금해서 도움을 요쳥했더니</p><li><p><code class="language-plaintext highlighter-rouge">redirection</code> 에 대해서 알려주신다.</p><li><p>bash<code class="language-plaintext highlighter-rouge"> 쉘도 </code>linux<code class="language-plaintext highlighter-rouge"> 니까 표준스트림 </code>redirection` 으로 출력물을 한꺼번에 파일로 옮길 수 있다는거다.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>node csv.js <span class="o">&gt;</span> data.csv
</pre></table></code></div></div><ul><li>이렇게 한 줄 적으면 끝나는 작업이다.<li>이걸 알게되는데 하루가 걸리다니… 그래도 너무 기분이 좋다 ㅠㅠ<li>좋은거야… 좋은거다 ㅠㅠ</ul><li><p>사실 리눅스 설치하고, 쉘스크립트에 대해서 학습할 때 분명히 설명을 듣긴 했었는데 제대로 이해하지 못했었다.</p><li><p>확실하게 또 한번 깨닫지만… 제대로 이해하지 못하고 넘어가면 결국 다시 돌아온다.</p><li><p>물론 학습 시간이 한정되어 있기 때문에 목적지향적으로 하는게 맞다는 생각이 들지만 때때로 어떤 부분은 배울 당시에 잘 이해하고 있었다면 목적을 향해 달려가는데 훨씬 많은 시간을 단축해줬을 것이라는 아쉬움도 남는다.</p></ul></ol><h3 id="3--이제-bulk-insert를-시도해보자">3. 이제 Bulk insert를 시도해보자.</h3><hr /><ul><li>어느정도 예상은 했지만 이것 또한 순탄치 않았다.<li>어떤 이상한 권한 문제에 걸려서 이날 밤 결국 포기하고 잠들어야만 했다.<li><p>이 과정을 기록을 했어야 했는데, 약간 반수면 상태에서 이것저것 오류만 나고 안된다는 사실에 좀 흥분했는지 오류에 대한 기록이 없다.</p><li>내 선택은 하루 미루고, 내일 다시 도전해보자 였다.<li>컴터를 켜자마자 도커에 있는 mysql 이미지를 전부 다 삭제하고, 다시 처임부터 차근차근 시작해봤다.<li>아마도 첫번째로 <code class="language-plaintext highlighter-rouge">mysql version</code> 문제를 간과하고, 임시방편으로 요령껏 문제를 처리했던게 어딘가부터 꼬여서 권한문제로 인한 <code class="language-plaintext highlighter-rouge">LOAD DATA</code> 를 실패하게 했던 것 같다.</ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://user-images.githubusercontent.com/70361152/106396289-574db500-644a-11eb-9830-8ce954a5fd69.png" alt="screenshot083" /></p><ul><li>뭐 덕분에 피하려고 했던 <code class="language-plaintext highlighter-rouge">sql</code> 문법에 대해서 좀 더 다가서게 됐고, 몇 가지 영상을 더 찾아보고 공부하면서 <code class="language-plaintext highlighter-rouge">mysql</code> 환경에서도 조금 더 편하게 작업할 수 있었다.<li><code class="language-plaintext highlighter-rouge">root</code> 의 권한 설정도 외부접속제한 할 수 있도록 잘 바뀌었고, <code class="language-plaintext highlighter-rouge">%</code> 와일드카드 권한에 대해서도 좀 더 이해할 수 있었다.<li><code class="language-plaintext highlighter-rouge">docker</code> 컨테이너 안으로 파일을 복사해서 (또 <code class="language-plaintext highlighter-rouge">DD</code> 의 도움을 받았었다…ㅠ고마운 <code class="language-plaintext highlighter-rouge">DD</code>) 결국에는 4.56sec에 통째로 밀어넣기에 성공했다.</ul><h3 id="4--삽질후기">4. 삽질후기</h3><hr /><ul><li>너무 돌아오니까 힘들다.<li>돌아오면서 분명히 배운것들이 있었을텐데 제대로 정리한 것 없이 놓쳤다. 마음이 급했던 것 같다.<li>조금 더 꼼꼼하게 작업할 필요가 있는 것 같다. 처음에 mysql 버젼으로 인해 일어날 수 있는 문제에 대해 조금 더 찾아보고 시작했더라면 기록하지 못한 여러가지 요소에서도 시간을 단축하고, 본래 목적에 맞게 조금 더 학습할 수 있었을 것 같다.<li>뭐 그래도 재미있었다. 살면서 백만개 데이터 푸쉬해본건 처음이니까.</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/digging/'>Digging</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/mysql/" class="post-tag no-text-decoration" >mysql</a> <a href="/tags/bulk-insert/" class="post-tag no-text-decoration" >bulk insert</a> <a href="/tags/database/" class="post-tag no-text-decoration" >database</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="" data-toggle="tooltip" data-placement="top" title="" target="_blank" rel="noopener" aria-label=""> <i class="fa-fw "></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/silent-night/">[thinkAbout] 새벽감성으로 생각정리하기</a><li><a href="/posts/front03-day5/">[Digging] 어쩌다보니 Node debugging 환경 세팅</a><li><a href="/posts/git/">[HTML/CSS] Git 기본기 연습</a><li><a href="/posts/http/">[CS] Text Browser를 만들어보자</a><li><a href="/posts/bulk-insert/">[Digging] Data 백만개 어떻게 처리하지..(feat. bulk insert)</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/database/">database</a> <a class="post-tag" href="/tags/dns/">dns</a> <a class="post-tag" href="/tags/domain/">domain</a> <a class="post-tag" href="/tags/http/">http</a> <a class="post-tag" href="/tags/mysql/">mysql</a> <a class="post-tag" href="/tags/register/">register</a> <a class="post-tag" href="/tags/socket/">socket</a> <a class="post-tag" href="/tags/tcp/">tcp</a> <a class="post-tag" href="/tags/udp/">udp</a> <a class="post-tag" href="/tags/wire-shark/">wire shark</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/docker/"><div class="card-body"> <span class="timeago small" > Feb 1 <i class="unloaded">2021-02-01T05:10:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[CS] 도커(Docker)와의 조우, 그리고 mySQL</h3><div class="text-muted small"><p> 도커(Docker)와의 조우, 그리고 mySQL VS Code 익스텐션으로 처음만난 친구다. 이름도 외모도 귀엽게 생겨서 설치는 했는데 어떻게 쓰는줄을 몰라서 무용지물이었다. 초보를 위한 도커 안내서 - 도커란 무엇인가? 가장 쉽게 배우는 도커 위에 글은 링크에 링크가 있고, 아래 유튭 영상이 개념상 이해할만 했다. 그러니까 이해한대로 요약해...</p></div></div></a></div><div class="card"> <a href="/posts/algorithm-hacker-rank/"><div class="card-body"> <span class="timeago small" > Jan 28 <i class="unloaded">2021-01-28T03:15:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[Algorithm] Hacker Rank 와의 첫만남, 그리고...(feat.CodeForce)</h3><div class="text-muted small"><p> 하루하루가 멘붕의 연속이다. 오늘은 Hacker Rank 라는 사이트를 처음 만나서 4문제를 풀고, Code Force 라는 곳에서 가상대회에 출전을 해본다. 어제 차마 마져 구현하지 못한 ‘카페 이벤트’ 때문에 오후 4시까지 해커랭크 문제를 다 푼다. 곧바로 가상대회(2시간)에 참가해서 6시 30전후로 마친다. 카페 이벤트 코드를 점검...</p></div></div></a></div><div class="card"> <a href="/posts/chart/"><div class="card-body"> <span class="timeago small" > Feb 4 <i class="unloaded">2021-02-04T01:05:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>[CS] Canvas api를 이용한 Chart 그리기</h3><div class="text-muted small"><p> 매일봐서 친하다고 생각했던 HTTP의 새로운 면모 어제 오늘은 HTTP 에 대해서 공부를 했다. 매일보고, 오래봐서 친하다고 생각했던 HTTP 와 더욱 친할 필요가 있고, 참조 readFile (vs) createReadStream “create csv file nodejs” Code Answer’s File API Read...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/algorithm-hacker-rank/" class="btn btn-outline-primary"><p>[Algorithm] Hacker Rank 와의 첫만남, 그리고...(feat.CodeForce)</p></a> <a href="/posts/docker/" class="btn btn-outline-primary"><p>[CS] 도커(Docker)와의 조우, 그리고 mySQL</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="font-italic text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//digging-raccoon.disqus.com/embed.js', disqusConfig: function() { this.page.url = 'https://juddroid.github.io/posts/bulk-insert/'; this.page.identifier = '/posts/bulk-insert/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://github.com/juddroid">Raccoon</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/database/">database</a> <a class="post-tag" href="/tags/dns/">dns</a> <a class="post-tag" href="/tags/domain/">domain</a> <a class="post-tag" href="/tags/http/">http</a> <a class="post-tag" href="/tags/mysql/">mysql</a> <a class="post-tag" href="/tags/register/">register</a> <a class="post-tag" href="/tags/socket/">socket</a> <a class="post-tag" href="/tags/tcp/">tcp</a> <a class="post-tag" href="/tags/udp/">udp</a> <a class="post-tag" href="/tags/wire-shark/">wire shark</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://juddroid.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-35DGNMXRP7"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-35DGNMXRP7'); }); </script>
